<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Dj-Stripe Team" /><link rel="canonical" href="https://dj-stripe.github.io/dj-stripe/2.7/reference/settings/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Settings - Dj-Stripe</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Settings";
        var mkdocs_page_input_path = "reference/settings.md";
        var mkdocs_page_url = "/dj-stripe/2.7/reference/settings/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Dj-Stripe
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../project/sponsors/">Sponsors</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api_keys/">Managing Stripe API Keys</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api_versions/">A note on Stripe API Versions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../stripe_elements_js/">Integrating Stripe Elements</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Release notes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_7_0/">dj-stripe 2.7 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_6_0/">dj-stripe 2.6 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_5_0/">dj-stripe 2.5 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_4_x/">dj-stripe 2.4.1 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_4_0/">dj-stripe 2.4 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/2_x/">dj-stripe 2.0 ~ 2.3 release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/1_x/">dj-stripe 1.x release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../history/0_x/">dj-stripe 0.x release notes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/webhooks/">Using Stripe Webhooks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/subscribing_customers/">Subscribing a customer to a plan</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/managing_subscriptions/">Managing subscriptions and payment sources</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/manually_syncing_with_stripe/">Manually syncing data with Stripe</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/creating_individual_charges/">Creating individual charges</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/creating_usage_record/">Creating Usage Records</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/using_stripe_checkout/">Using Stripe Checkout</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/using_with_docker/">Using with Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/local_webhook_testing/">Development with local webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Project</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/contributing/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/test_fixtures/">Test Fixtures</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/authors/">Credits</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/support/">Support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../project/release_process/">Release Process</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../enums/">Enumerations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../managers/">Managers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../models/">Models</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Settings</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#stripe_api_version-2020-08-27">STRIPE_API_VERSION (='2020-08-27')</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_foreign_key_to_field">DJSTRIPE_FOREIGN_KEY_TO_FIELD</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_idempotency_key_callback-djstripesettingsdjstripe_settings_get_idempotency_key">DJSTRIPE_IDEMPOTENCY_KEY_CALLBACK (=djstripe.settings.djstripe_settings._get_idempotency_key)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_subscriber_customer_key-djstripe_subscriber">DJSTRIPE_SUBSCRIBER_CUSTOMER_KEY (="djstripe_subscriber")</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_subscriber_model-settingsauth_user_model">DJSTRIPE_SUBSCRIBER_MODEL (=settings.AUTH_USER_MODEL)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_subscriber_model_migration_dependency-__first__">DJSTRIPE_SUBSCRIBER_MODEL_MIGRATION_DEPENDENCY (="__first__")</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_webhook_url-rwebhook">DJSTRIPE_WEBHOOK_URL (=r"^webhook/$")</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_webhook_secret">DJSTRIPE_WEBHOOK_SECRET (="")</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_webhook_validation-verify_signature">DJSTRIPE_WEBHOOK_VALIDATION= (="verify_signature")</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_webhook_tolerance-300">DJSTRIPE_WEBHOOK_TOLERANCE (=300)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe_webhook_event_callback-none">DJSTRIPE_WEBHOOK_EVENT_CALLBACK (=None)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#stripe_api_host-unset">STRIPE_API_HOST (= unset)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#source-code">Source Code</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.settings">djstripe.settings</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.settings-attributes">Attributes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.settings.djstripe_settings">djstripe_settings</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#djstripe.settings-classes">Classes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#djstripe.settings.DjstripeSettings">DjstripeSettings</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.settings.DjstripeSettings-attributes">Attributes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#djstripe.settings.DjstripeSettings-functions">Functions</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../utils/">Utilities</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Dj-Stripe</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Reference &raquo;</li>
      <li>Settings</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/dj-stripe/dj-stripe/edit/master/docs/reference/settings.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="settings">Settings</h1>
<h2 id="stripe_api_version-2020-08-27">STRIPE_API_VERSION (='2020-08-27')</h2>
<p>The API version used to communicate with the Stripe API is configurable, and defaults to
the latest version that has been tested as working. Using a value other than the default
is allowed, as a string in the format of YYYY-MM-DD.</p>
<p>For example, you can specify <code>"2020-03-02"</code> to use that API version:</p>
<div class="highlight"><pre><span></span><code><span class="n">STRIPE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2020-03-02&quot;</span>
</code></pre></div>
<p>However you do so at your own risk, as using a value other than the default might result
in incompatibilities between Stripe and this library, especially if Stripe has labelled
the differences between API versions as "Major". Even small differences such as a new
enumeration value might cause issues.</p>
<p>For this reason it is best to assume that only the default version is supported.</p>
<p>For more information on API versioning, see the <a href="https://stripe.com/docs/upgrades">stripe
documentation</a>.</p>
<p>See also <a href="../../api_versions/#a_note_on_stripe_api_versions">API Versions</a>.</p>
<h2 id="djstripe_foreign_key_to_field">DJSTRIPE_FOREIGN_KEY_TO_FIELD</h2>
<p><em>(Introduced in 2.4.0)</em></p>
<p><code>DJSTRIPE_FOREIGN_KEY_TO_FIELD</code> is a setting introduced in dj-stripe version 2.4.0. You
are required to set it in 2.4.0: It does not have a default value. In 3.0.0, the default
will be "id", and we recommend setting it to "id" for new installations. Older
installations should set it to "djstripe_id". Explanation below.</p>
<p>In dj-stripe 2.3 and before, foreign keys for Stripe models were set to point to the
foreign model's djstripe_id field, a numeric integer generated by the local database.
This new setting allows dj-stripe users to change it to use the "id" field, which is the
upstream, non-numeric Stripe identifier.</p>
<p>When using the Stripe identifier as a foreign key, synchronization between Stripe and
dj-stripe can be made far more efficient and robust. Furthermore, it removes the
per-installation instability of a critical value. The plan is to get rid of djstripe_id
altogether for the 3.0 release (we may retain the field itself until 4.0, but it will no
longer be a primary key).</p>
<p><strong>How to migrate older installations from "djstripe_id" to "id"?</strong></p>
<p>Such a migration path has not been designed at the moment. Currently if you want to
switch an older installation to "id", the easiest way is to wipe the djstripe db and
sync again from scratch. This is obviously not ideal, and we will design a proper
migration path before 3.0.</p>
<h2 id="djstripe_idempotency_key_callback-djstripesettingsdjstripe_settings_get_idempotency_key">DJSTRIPE_IDEMPOTENCY_KEY_CALLBACK (=djstripe.settings.djstripe_settings._get_idempotency_key)</h2>
<p>A function which will return an idempotency key for a particular object_type and action
pair. By default, this is set to a function which will create a
<code>djstripe.IdempotencyKey</code> object and return its <code>uuid</code>. You may want to customize this
if you want to give your idempotency keys a different lifecycle than they normally would
get.</p>
<p>The function takes the following signature:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_idempotency_key</span><span class="p">(</span><span class="n">object_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">livemode</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;idempotency key&gt;&quot;</span>
</code></pre></div>
<p>The function MUST return a string suitably random for the object_type/action pair, and
usable in the Stripe <code>Idempotency-Key</code> HTTP header. For more information, see the
<a href="https://stripe.com/docs/upgrades">stripe documentation</a>.</p>
<h2 id="djstripe_subscriber_customer_key-djstripe_subscriber">DJSTRIPE_SUBSCRIBER_CUSTOMER_KEY (="djstripe_subscriber")</h2>
<p>Every Customer object created in Stripe is tagged with
<a href="https://stripe.com/docs/api#metadata">metadata</a> This setting controls what the name of
the key in Stripe should be. The key name must be a string no more than 40 characters
long.</p>
<p>You may set this to <code>None</code> or <code>""</code> to disable that behaviour altogether. This is
probably not something you want to do, though.</p>
<h2 id="djstripe_subscriber_model-settingsauth_user_model">DJSTRIPE_SUBSCRIBER_MODEL (=settings.AUTH_USER_MODEL)</h2>
<p>If the AUTH_USER_MODEL doesn't represent the object your application's subscription
holder, you may define a subscriber model to use here. It should be a string in the form
of 'app.model'.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>DJSTRIPE_SUBSCRIBER_MODEL must have an <code>email</code> field. If your
existing model has no email field, add an email property that
defines an email address to use.</p>
</div>
<p>Example Model:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Organization</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">admin</span> <span class="o">=</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">admin</span><span class="o">.</span><span class="n">email</span>
</code></pre></div>
<h2 id="djstripe_subscriber_model_migration_dependency-__first__">DJSTRIPE_SUBSCRIBER_MODEL_MIGRATION_DEPENDENCY (="__first__")</h2>
<p>If the model referenced in DJSTRIPE_SUBSCRIBER_MODEL is not created in the <code>__first__</code>
migration of an app you can specify the migration name to depend on here. For example:
"0003_here_the_subscriber_model_was_added"</p>
<h2 id="djstripe_webhook_url-rwebhook">DJSTRIPE_WEBHOOK_URL (=r"^webhook/$")</h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This setting is deprecated and will be removed in dj-stripe 2.9.</p>
</div>
<p>This is where you can tell Stripe to send webhook responses. You can set this to what
you want to prevent unnecessary hijinks from unfriendly people.</p>
<p>As this is embedded in the URLConf, this must be a resolvable regular expression.</p>
<h2 id="djstripe_webhook_secret">DJSTRIPE_WEBHOOK_SECRET (="")</h2>
<p>If this is set to a non-empty value, webhook signatures will be verified.</p>
<p><a href="https://stripe.com/docs/webhooks/signatures">Learn more about webhook signature
verification</a>.</p>
<h2 id="djstripe_webhook_validation-verify_signature">DJSTRIPE_WEBHOOK_VALIDATION= (="verify_signature")</h2>
<p>This setting controls which type of validation is done on webhooks. Value can be
<code>"verify_signature"</code> for signature verification (recommended default),
<code>"retrieve_event"</code> for event retrieval (makes an extra HTTP request), or <code>None</code> for no
validation at all.</p>
<h2 id="djstripe_webhook_tolerance-300">DJSTRIPE_WEBHOOK_TOLERANCE (=300)</h2>
<p>Controls the milliseconds tolerance which wards against replay attacks. Leave this to
its default value unless you know what you're doing.</p>
<h2 id="djstripe_webhook_event_callback-none">DJSTRIPE_WEBHOOK_EVENT_CALLBACK (=None)</h2>
<p>Webhook event callbacks allow an application to take control of what happens when an
event from Stripe is received. It must be a callable or importable string to a callable
that takes an event object.</p>
<p>One suggestion is to put the event onto a task queue (such as celery) for asynchronous
processing.</p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># callbacks.py</span>
<span class="k">def</span> <span class="nf">webhook_event_callback</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Dispatches the event to celery for processing. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">tasks</span>
    <span class="c1"># Ansychronous hand-off to celery so that we can continue immediately</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">process_webhook_event</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># tasks.py</span>
<span class="kn">from</span> <span class="nn">djstripe.models</span> <span class="kn">import</span> <span class="n">WebhookEventTrigger</span>
<span class="kn">from</span> <span class="nn">stripe.error</span> <span class="kn">import</span> <span class="n">StripeError</span>

<span class="nd">@shared_task</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">process_webhook_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Processes events from Stripe asynchronously. &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing Stripe event: </span><span class="si">{</span><span class="n">pk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># get the event</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="c1"># process the event.</span>
        <span class="c1"># internally, this creates a Stripe WebhookEvent Object and invokes the respective Webhooks</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">process</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">StripeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process Stripe event: </span><span class="si">{</span><span class="n">pk</span><span class="si">}</span><span class="s2">. Retrying in 60 seconds.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>  <span class="c1"># retry after 60 seconds</span>
    <span class="k">except</span> <span class="n">WebhookEventTrigger</span><span class="o">.</span><span class="n">DoesNotExist</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># This can happen in case the celery task got executed before the actual model got saved to the DB</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span> <span class="n">countdown</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># retry after 10 seconds</span>

    <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="ow">or</span> <span class="s2">&quot;Stripe Event Processed&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># settings.py</span>
<span class="n">DJSTRIPE_WEBHOOK_EVENT_CALLBACK</span> <span class="o">=</span> <span class="s1">&#39;callbacks.webhook_event_callback&#39;</span>
</code></pre></div>
<h2 id="stripe_api_host-unset">STRIPE_API_HOST (= unset)</h2>
<p>If set, this sets the base API host for Stripe. You may want to set this to, for
example, <code>"http://localhost:12111"</code> if you are running
<a href="https://github.com/stripe/stripe-mock">stripe-mock</a>.</p>
<p>If this is set in production (DEBUG=False), a warning will be raised on <code>manage.py check</code>.</p>
<h2 id="source-code">Source Code</h2>


<div class="doc doc-object doc-module">


<a id="djstripe.settings"></a>
  <div class="doc doc-contents first">
  
      <p>dj-stripe settings</p>

  

  <div class="doc doc-children">





<h2 id="djstripe.settings-attributes">Attributes</h2>

<div class="doc doc-object doc-attribute">



<h3 id="djstripe.settings.djstripe_settings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">djstripe_settings</span> <span class="o">=</span> <span class="n">DjstripeSettings</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  </div>

</div>
<h2 id="djstripe.settings-classes">Classes</h2>

<div class="doc doc-object doc-class">



<h3 id="djstripe.settings.DjstripeSettings" class="doc doc-heading">
        <code>djstripe.settings.DjstripeSettings</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>Container for Dj-stripe settings</p>
<p>:return: Initialised settings for Dj-stripe.
:rtype: object</p>


        <details class="quote">
          <summary>Source code in <code>djstripe/settings.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DjstripeSettings</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for Dj-stripe settings</span>

<span class="sd">    :return: Initialised settings for Dj-stripe.</span>
<span class="sd">    :rtype: object</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_STRIPE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2020-08-27&quot;</span>

    <span class="n">ZERO_DECIMAL_CURRENCIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;bif&quot;</span><span class="p">,</span>
        <span class="s2">&quot;clp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;djf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gnf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;jpy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;kmf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;krw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mga&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pyg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rwf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vnd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vuv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;xaf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;xof&quot;</span><span class="p">,</span>
        <span class="s2">&quot;xpf&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Set STRIPE_API_HOST if you want to use a different Stripe API server</span>
        <span class="c1"># Example: https://github.com/stripe/stripe-mock</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_API_HOST&quot;</span><span class="p">):</span>
            <span class="n">stripe</span><span class="o">.</span><span class="n">api_base</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_API_HOST&quot;</span><span class="p">)</span>

    <span class="c1"># generic setter and deleter methods to ensure object patching works</span>
    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subscriber_request_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_callback_function</span><span class="p">(</span>
            <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL_REQUEST_CALLBACK&quot;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">request</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_idempotency_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_callback_function</span><span class="p">(</span>
            <span class="s2">&quot;DJSTRIPE_IDEMPOTENCY_KEY_CALLBACK&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_idempotency_key</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">DJSTRIPE_WEBHOOK_URL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;DJSTRIPE_WEBHOOK_URL&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;^webhook/$&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">WEBHOOK_TOLERANCE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;DJSTRIPE_WEBHOOK_TOLERANCE&quot;</span><span class="p">,</span> <span class="n">stripe</span><span class="o">.</span><span class="n">Webhook</span><span class="o">.</span><span class="n">DEFAULT_TOLERANCE</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">WEBHOOK_VALIDATION</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;DJSTRIPE_WEBHOOK_VALIDATION&quot;</span><span class="p">,</span> <span class="s2">&quot;verify_signature&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">WEBHOOK_SECRET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;DJSTRIPE_WEBHOOK_SECRET&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Webhook event callbacks allow an application to take control of what happens</span>
    <span class="c1"># when an event from Stripe is received.  One suggestion is to put the event</span>
    <span class="c1"># onto a task queue (such as celery) for asynchronous processing.</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">WEBHOOK_EVENT_CALLBACK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_callback_function</span><span class="p">(</span><span class="s2">&quot;DJSTRIPE_WEBHOOK_EVENT_CALLBACK&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">SUBSCRIBER_CUSTOMER_KEY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_CUSTOMER_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;djstripe_subscriber&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">TEST_API_KEY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_TEST_SECRET_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">LIVE_API_KEY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_LIVE_SECRET_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Determines whether we are in live mode or test mode</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">STRIPE_LIVE_MODE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_LIVE_MODE&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">STRIPE_SECRET_KEY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Default secret key</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_SECRET_KEY&quot;</span><span class="p">):</span>
            <span class="n">STRIPE_SECRET_KEY</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">STRIPE_SECRET_KEY</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LIVE_API_KEY</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRIPE_LIVE_MODE</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEST_API_KEY</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">STRIPE_SECRET_KEY</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">STRIPE_PUBLIC_KEY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Default public key</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_PUBLIC_KEY&quot;</span><span class="p">):</span>
            <span class="n">STRIPE_PUBLIC_KEY</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">STRIPE_PUBLIC_KEY</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRIPE_LIVE_MODE</span><span class="p">:</span>
            <span class="n">STRIPE_PUBLIC_KEY</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_LIVE_PUBLIC_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">STRIPE_PUBLIC_KEY</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_TEST_PUBLIC_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">STRIPE_PUBLIC_KEY</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">STRIPE_API_VERSION</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the desired API version to use for Stripe requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_API_VERSION&quot;</span><span class="p">,</span> <span class="n">stripe</span><span class="o">.</span><span class="n">api_version</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_STRIPE_API_VERSION</span>

    <span class="k">def</span> <span class="nf">get_callback_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setting_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resolve a callback function based on a setting name.</span>

<span class="sd">        If the setting value isn&#39;t set, default is returned.  If the setting value</span>
<span class="sd">        is already a callable function, that value is used - If the setting value</span>
<span class="sd">        is a string, an attempt is made to import it.  Anything else will result in</span>
<span class="sd">        a failed import causing ImportError to be raised.</span>

<span class="sd">        :param setting_name: The name of the setting to resolve a callback from.</span>
<span class="sd">        :type setting_name: string (``str``/``unicode``)</span>
<span class="sd">        :param default: The default to return if setting isn&#39;t populated.</span>
<span class="sd">        :type default: ``bool``</span>
<span class="sd">        :returns: The resolved callback function (if any).</span>
<span class="sd">        :type: ``callable``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">setting_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">func</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">import_string</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">setting_name</span><span class="si">}</span><span class="s2"> must be callable.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">_get_idempotency_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_type</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">livemode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">IdempotencyKey</span>

        <span class="n">action</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">object_type</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">idempotency_key</span><span class="p">,</span> <span class="n">_created</span> <span class="o">=</span> <span class="n">IdempotencyKey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
            <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">livemode</span><span class="o">=</span><span class="n">livemode</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">idempotency_key</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_default_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">livemode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the default API key for a value of `livemode`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">livemode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Livemode is unknown. Use the default secret key.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
        <span class="k">elif</span> <span class="n">livemode</span><span class="p">:</span>
            <span class="c1"># Livemode is true, use the live secret key</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIVE_API_KEY</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Livemode is false, use the test secret key</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEST_API_KEY</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>

    <span class="k">def</span> <span class="nf">get_subscriber_model_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the configured subscriber model as a module path string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">def</span> <span class="nf">get_subscriber_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to pull settings.DJSTRIPE_SUBSCRIBER_MODEL.</span>

<span class="sd">        Users have the option of specifying a custom subscriber model via the</span>
<span class="sd">        DJSTRIPE_SUBSCRIBER_MODEL setting.</span>

<span class="sd">        This methods falls back to AUTH_USER_MODEL if DJSTRIPE_SUBSCRIBER_MODEL is not set.</span>

<span class="sd">        Returns the subscriber model that is active in this project.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subscriber_model_string</span><span class="p">()</span>

        <span class="c1"># Attempt a Django 1.7 app lookup</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subscriber_model</span> <span class="o">=</span> <span class="n">django_apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL must be of the form &#39;app_label.model_name&#39;.&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL refers to model &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="s2">&quot;that has not been installed.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;email&quot;</span>
            <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">field_</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field_</span> <span class="ow">in</span> <span class="n">subscriber_model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()]</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subscriber_model</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL must have an email attribute.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">model_name</span> <span class="o">!=</span> <span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">:</span>
            <span class="c1"># Custom user model detected. Make sure the callback is configured.</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_callback_function</span><span class="p">(</span>
                <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL_REQUEST_CALLBACK&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">func</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                    <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL_REQUEST_CALLBACK must be implemented &quot;</span>
                    <span class="s2">&quot;if a DJSTRIPE_SUBSCRIBER_MODEL is defined.&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">subscriber_model</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h4 id="djstripe.settings.DjstripeSettings-attributes">Attributes</h4>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.DEFAULT_STRIPE_API_VERSION" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">DEFAULT_STRIPE_API_VERSION</span> <span class="o">=</span> <span class="s1">&#39;2020-08-27&#39;</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.DJSTRIPE_WEBHOOK_URL" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">DJSTRIPE_WEBHOOK_URL</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.LIVE_API_KEY" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">LIVE_API_KEY</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.STRIPE_API_VERSION" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">STRIPE_API_VERSION</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get the desired API version to use for Stripe requests.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.STRIPE_LIVE_MODE" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">STRIPE_LIVE_MODE</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.STRIPE_PUBLIC_KEY" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">STRIPE_PUBLIC_KEY</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.STRIPE_SECRET_KEY" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.SUBSCRIBER_CUSTOMER_KEY" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">SUBSCRIBER_CUSTOMER_KEY</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.TEST_API_KEY" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">TEST_API_KEY</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.WEBHOOK_EVENT_CALLBACK" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">WEBHOOK_EVENT_CALLBACK</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.WEBHOOK_SECRET" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">WEBHOOK_SECRET</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.WEBHOOK_TOLERANCE" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">WEBHOOK_TOLERANCE</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.WEBHOOK_VALIDATION" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">WEBHOOK_VALIDATION</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.ZERO_DECIMAL_CURRENCIES" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">ZERO_DECIMAL_CURRENCIES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bif&#39;</span><span class="p">,</span> <span class="s1">&#39;clp&#39;</span><span class="p">,</span> <span class="s1">&#39;djf&#39;</span><span class="p">,</span> <span class="s1">&#39;gnf&#39;</span><span class="p">,</span> <span class="s1">&#39;jpy&#39;</span><span class="p">,</span> <span class="s1">&#39;kmf&#39;</span><span class="p">,</span> <span class="s1">&#39;krw&#39;</span><span class="p">,</span> <span class="s1">&#39;mga&#39;</span><span class="p">,</span> <span class="s1">&#39;pyg&#39;</span><span class="p">,</span> <span class="s1">&#39;rwf&#39;</span><span class="p">,</span> <span class="s1">&#39;vnd&#39;</span><span class="p">,</span> <span class="s1">&#39;vuv&#39;</span><span class="p">,</span> <span class="s1">&#39;xaf&#39;</span><span class="p">,</span> <span class="s1">&#39;xof&#39;</span><span class="p">,</span> <span class="s1">&#39;xpf&#39;</span><span class="p">}</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.get_idempotency_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">get_idempotency_key</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="djstripe.settings.DjstripeSettings.subscriber_request_callback" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">subscriber_request_callback</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  </div>

</div>

<h4 id="djstripe.settings.DjstripeSettings-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="djstripe.settings.DjstripeSettings.__delattr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="fm">__delattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/settings.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.settings.DjstripeSettings.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/settings.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Set STRIPE_API_HOST if you want to use a different Stripe API server</span>
    <span class="c1"># Example: https://github.com/stripe/stripe-mock</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_API_HOST&quot;</span><span class="p">):</span>
        <span class="n">stripe</span><span class="o">.</span><span class="n">api_base</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;STRIPE_API_HOST&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.settings.DjstripeSettings.__setattr__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>djstripe/settings.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.settings.DjstripeSettings.get_callback_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">get_callback_function</span><span class="p">(</span><span class="n">setting_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Resolve a callback function based on a setting name.</p>
<p>If the setting value isn't set, default is returned.  If the setting value
is already a callable function, that value is used - If the setting value
is a string, an attempt is made to import it.  Anything else will result in
a failed import causing ImportError to be raised.</p>
<p>:param setting_name: The name of the setting to resolve a callback from.
:type setting_name: string (<code>str</code>/<code>unicode</code>)
:param default: The default to return if setting isn't populated.
:type default: <code>bool</code>
:returns: The resolved callback function (if any).
:type: <code>callable</code></p>

      <details class="quote">
        <summary>Source code in <code>djstripe/settings.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_callback_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setting_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolve a callback function based on a setting name.</span>

<span class="sd">    If the setting value isn&#39;t set, default is returned.  If the setting value</span>
<span class="sd">    is already a callable function, that value is used - If the setting value</span>
<span class="sd">    is a string, an attempt is made to import it.  Anything else will result in</span>
<span class="sd">    a failed import causing ImportError to be raised.</span>

<span class="sd">    :param setting_name: The name of the setting to resolve a callback from.</span>
<span class="sd">    :type setting_name: string (``str``/``unicode``)</span>
<span class="sd">    :param default: The default to return if setting isn&#39;t populated.</span>
<span class="sd">    :type default: ``bool``</span>
<span class="sd">    :returns: The resolved callback function (if any).</span>
<span class="sd">    :type: ``callable``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">setting_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">func</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>

    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">import_string</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">setting_name</span><span class="si">}</span><span class="s2"> must be callable.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">func</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.settings.DjstripeSettings.get_default_api_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">get_default_api_key</span><span class="p">(</span><span class="n">livemode</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Returns the default API key for a value of <code>livemode</code>.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/settings.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_default_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">livemode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the default API key for a value of `livemode`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">livemode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Livemode is unknown. Use the default secret key.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
    <span class="k">elif</span> <span class="n">livemode</span><span class="p">:</span>
        <span class="c1"># Livemode is true, use the live secret key</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">LIVE_API_KEY</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Livemode is false, use the test secret key</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TEST_API_KEY</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">STRIPE_SECRET_KEY</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.settings.DjstripeSettings.get_subscriber_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">get_subscriber_model</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Attempt to pull settings.DJSTRIPE_SUBSCRIBER_MODEL.</p>
<p>Users have the option of specifying a custom subscriber model via the
DJSTRIPE_SUBSCRIBER_MODEL setting.</p>
<p>This methods falls back to AUTH_USER_MODEL if DJSTRIPE_SUBSCRIBER_MODEL is not set.</p>
<p>Returns the subscriber model that is active in this project.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/settings.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_subscriber_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempt to pull settings.DJSTRIPE_SUBSCRIBER_MODEL.</span>

<span class="sd">    Users have the option of specifying a custom subscriber model via the</span>
<span class="sd">    DJSTRIPE_SUBSCRIBER_MODEL setting.</span>

<span class="sd">    This methods falls back to AUTH_USER_MODEL if DJSTRIPE_SUBSCRIBER_MODEL is not set.</span>

<span class="sd">    Returns the subscriber model that is active in this project.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subscriber_model_string</span><span class="p">()</span>

    <span class="c1"># Attempt a Django 1.7 app lookup</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subscriber_model</span> <span class="o">=</span> <span class="n">django_apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
            <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL must be of the form &#39;app_label.model_name&#39;.&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL refers to model &#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
            <span class="s2">&quot;that has not been installed.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="s2">&quot;email&quot;</span>
        <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">field_</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field_</span> <span class="ow">in</span> <span class="n">subscriber_model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()]</span>
    <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subscriber_model</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
            <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL must have an email attribute.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">model_name</span> <span class="o">!=</span> <span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">:</span>
        <span class="c1"># Custom user model detected. Make sure the callback is configured.</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_callback_function</span><span class="p">(</span>
            <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL_REQUEST_CALLBACK&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">func</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span>
                <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL_REQUEST_CALLBACK must be implemented &quot;</span>
                <span class="s2">&quot;if a DJSTRIPE_SUBSCRIBER_MODEL is defined.&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">subscriber_model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="djstripe.settings.DjstripeSettings.get_subscriber_model_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">djstripe</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">DjstripeSettings</span><span class="o">.</span><span class="n">get_subscriber_model_string</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get the configured subscriber model as a module path string.</p>

      <details class="quote">
        <summary>Source code in <code>djstripe/settings.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_subscriber_model_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the configured subscriber model as a module path string.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;DJSTRIPE_SUBSCRIBER_MODEL&quot;</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><p>selection:
filters: - "!^<em>[^</em>]"</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../models/" class="btn btn-neutral float-left" title="Models"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../utils/" class="btn btn-neutral float-right" title="Utilities">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/dj-stripe/dj-stripe/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../models/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../utils/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
      <script src="../../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
